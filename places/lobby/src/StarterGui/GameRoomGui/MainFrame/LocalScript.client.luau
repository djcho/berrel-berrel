local replicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local mainFrame = script.Parent

-- í•´ì  ì»¨ì…‰ ìƒ‰ìƒ
local COLORS = {
	woodDark = Color3.fromRGB(62, 39, 22),
	woodLight = Color3.fromRGB(101, 67, 33),
	gold = Color3.fromRGB(255, 200, 50),
	goldDark = Color3.fromRGB(180, 140, 30),
	parchment = Color3.fromRGB(210, 180, 140),
	rope = Color3.fromRGB(139, 119, 83),
	red = Color3.fromRGB(200, 60, 60),
	black = Color3.fromRGB(20, 15, 10),
	green = Color3.fromRGB(50, 180, 50),
	blue = Color3.fromRGB(70, 130, 180),
	teamRed = Color3.fromRGB(255, 100, 100),
	teamBlue = Color3.fromRGB(100, 150, 255),
	white = Color3.fromRGB(255, 255, 255),
}

-- ë°© ë°ì´í„° ìºì‹œ (ì„œë²„ì—ì„œ liveStatus í¬í•¨í•´ì„œ ì „ì†¡)
local roomDataCache = {}

-- ê²Œì„ ëª¨ë“œ ì•„ì´ì½˜ (ì„œë²„ì—ì„œ ë°›ì€ ëª¨ë“œì— ë”°ë¼ ë‹¤ë¥¸ ì•„ì´ì½˜ ì‚¬ìš©)
local GAME_MODE_ICONS = {
	deathmatch = "rbxassetid://110698591776828",
	-- ì¶”í›„ ë‹¤ë¥¸ ëª¨ë“œ ì¶”ê°€
	-- capture = "rbxassetid://...",
	-- survival = "rbxassetid://...",
}
local TITLE_ICON = "rbxassetid://131431773353571" -- ê²Œì„ ì°¸ê°€ íƒ€ì´í‹€ ì•„ì´ì½˜

-- ë©”ì¸ í”„ë ˆì„ ìŠ¤íƒ€ì¼ ì ìš©
mainFrame.BackgroundColor3 = COLORS.woodDark

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 16)
mainCorner.Parent = mainFrame

local mainStroke = Instance.new("UIStroke")
mainStroke.Color = COLORS.goldDark
mainStroke.Thickness = 4
mainStroke.Parent = mainFrame

-- ì‹œê°„ í¬ë§· í•¨ìˆ˜
local function formatTime(seconds)
	local mins = math.floor(seconds / 60)
	local secs = math.floor(seconds % 60)
	return string.format("%d:%02d", mins, secs)
end

-- GUI ìš”ì†Œ ì°¸ì¡° ì €ì¥
local guiElements = {}

-- GUI ìš”ì†Œ ë™ì  ìƒì„±
local function createGuiElements()
	-- ìƒë‹¨ ë°”
	local topBar = Instance.new("Frame")
	topBar.Name = "TopBar"
	topBar.Size = UDim2.new(1, 0, 0, 60)
	topBar.Position = UDim2.new(0, 0, 0, 0)
	topBar.BackgroundColor3 = COLORS.woodLight
	topBar.BorderSizePixel = 0
	topBar.Parent = mainFrame

	local topBarCorner = Instance.new("UICorner")
	topBarCorner.CornerRadius = UDim.new(0, 16)
	topBarCorner.Parent = topBar

	-- íƒ€ì´í‹€ ì•„ì´ì½˜ (ê²Œì„ ì°¸ê°€ ì•„ì´ì½˜)
	local titleIcon = Instance.new("ImageLabel")
	titleIcon.Size = UDim2.new(0, 40, 0, 40)
	titleIcon.Position = UDim2.new(0, 12, 0, 10)
	titleIcon.BackgroundTransparency = 1
	titleIcon.Image = TITLE_ICON
	titleIcon.Parent = topBar

	-- íƒ€ì´í‹€
	local titleLabel = Instance.new("TextLabel")
	titleLabel.Name = "TitleLabel"
	titleLabel.Size = UDim2.new(0, 200, 0, 30)
	titleLabel.Position = UDim2.new(0, 50, 0, 8)
	titleLabel.BackgroundTransparency = 1
	titleLabel.TextColor3 = COLORS.gold
	titleLabel.Text = "ê²Œì„ ì°¸ê°€"
	titleLabel.TextSize = 24
	titleLabel.Font = Enum.Font.GothamBlack
	titleLabel.TextXAlignment = Enum.TextXAlignment.Left
	titleLabel.Parent = topBar

	-- ì„œë¸Œíƒ€ì´í‹€
	local subTitleLabel = Instance.new("TextLabel")
	subTitleLabel.Size = UDim2.new(0, 200, 0, 20)
	subTitleLabel.Position = UDim2.new(0, 50, 0, 36)
	subTitleLabel.BackgroundTransparency = 1
	subTitleLabel.TextColor3 = COLORS.parchment
	subTitleLabel.Text = "ë°©ì„ ì„ íƒí•˜ì„¸ìš”"
	subTitleLabel.TextSize = 13
	subTitleLabel.Font = Enum.Font.GothamBold
	subTitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	subTitleLabel.Parent = topBar

	-- ë‹«ê¸° ë²„íŠ¼
	local closeButton = Instance.new("TextButton")
	closeButton.Name = "CloseButton"
	closeButton.Size = UDim2.new(0, 40, 0, 40)
	closeButton.Position = UDim2.new(1, -50, 0, 10)
	closeButton.BackgroundColor3 = COLORS.red
	closeButton.TextColor3 = COLORS.white
	closeButton.Text = "X"
	closeButton.TextSize = 22
	closeButton.Font = Enum.Font.GothamBlack
	closeButton.Parent = topBar

	local closeCorner = Instance.new("UICorner")
	closeCorner.CornerRadius = UDim.new(0, 10)
	closeCorner.Parent = closeButton

	-- ìš”ì•½ ì •ë³´ ë°”
	local summaryBar = Instance.new("Frame")
	summaryBar.Name = "SummaryBar"
	summaryBar.Size = UDim2.new(1, -40, 0, 70)
	summaryBar.Position = UDim2.new(0, 20, 0, 70)
	summaryBar.BackgroundColor3 = COLORS.black
	summaryBar.BackgroundTransparency = 0.3
	summaryBar.Parent = mainFrame

	local summaryCorner = Instance.new("UICorner")
	summaryCorner.CornerRadius = UDim.new(0, 12)
	summaryCorner.Parent = summaryBar

	-- ì´ ë°© ìˆ˜
	local roomCountFrame = Instance.new("Frame")
	roomCountFrame.Size = UDim2.new(0.33, 0, 1, 0)
	roomCountFrame.Position = UDim2.new(0, 0, 0, 0)
	roomCountFrame.BackgroundTransparency = 1
	roomCountFrame.Parent = summaryBar

	local roomCountLabel = Instance.new("TextLabel")
	roomCountLabel.Name = "RoomCountLabel"
	roomCountLabel.Size = UDim2.new(1, 0, 0, 35)
	roomCountLabel.Position = UDim2.new(0, 0, 0, 8)
	roomCountLabel.BackgroundTransparency = 1
	roomCountLabel.TextColor3 = COLORS.gold
	roomCountLabel.Text = "0"
	roomCountLabel.TextSize = 28
	roomCountLabel.Font = Enum.Font.GothamBlack
	roomCountLabel.Parent = roomCountFrame
	guiElements.roomCountLabel = roomCountLabel

	local roomCountText = Instance.new("TextLabel")
	roomCountText.Size = UDim2.new(1, 0, 0, 20)
	roomCountText.Position = UDim2.new(0, 0, 0, 42)
	roomCountText.BackgroundTransparency = 1
	roomCountText.TextColor3 = COLORS.parchment
	roomCountText.Text = "ì—´ë¦° ë°©"
	roomCountText.TextSize = 12
	roomCountText.Font = Enum.Font.GothamBold
	roomCountText.Parent = roomCountFrame

	-- ì´ í”Œë ˆì´ì–´ ìˆ˜
	local playerCountFrame = Instance.new("Frame")
	playerCountFrame.Size = UDim2.new(0.33, 0, 1, 0)
	playerCountFrame.Position = UDim2.new(0.33, 0, 0, 0)
	playerCountFrame.BackgroundTransparency = 1
	playerCountFrame.Parent = summaryBar

	local playerCountLabel = Instance.new("TextLabel")
	playerCountLabel.Name = "PlayerCountLabel"
	playerCountLabel.Size = UDim2.new(1, 0, 0, 35)
	playerCountLabel.Position = UDim2.new(0, 0, 0, 8)
	playerCountLabel.BackgroundTransparency = 1
	playerCountLabel.TextColor3 = COLORS.green
	playerCountLabel.Text = "0"
	playerCountLabel.TextSize = 28
	playerCountLabel.Font = Enum.Font.GothamBlack
	playerCountLabel.Parent = playerCountFrame
	guiElements.playerCountLabel = playerCountLabel

	local playerCountText = Instance.new("TextLabel")
	playerCountText.Size = UDim2.new(1, 0, 0, 20)
	playerCountText.Position = UDim2.new(0, 0, 0, 42)
	playerCountText.BackgroundTransparency = 1
	playerCountText.TextColor3 = COLORS.parchment
	playerCountText.Text = "í”Œë ˆì´ ì¤‘"
	playerCountText.TextSize = 12
	playerCountText.Font = Enum.Font.GothamBold
	playerCountText.Parent = playerCountFrame

	-- ê²Œì„ ì¤‘ì¸ ë°© ìˆ˜
	local activeCountFrame = Instance.new("Frame")
	activeCountFrame.Size = UDim2.new(0.33, 0, 1, 0)
	activeCountFrame.Position = UDim2.new(0.66, 0, 0, 0)
	activeCountFrame.BackgroundTransparency = 1
	activeCountFrame.Parent = summaryBar

	local activeCountLabel = Instance.new("TextLabel")
	activeCountLabel.Name = "ActiveCountLabel"
	activeCountLabel.Size = UDim2.new(1, 0, 0, 35)
	activeCountLabel.Position = UDim2.new(0, 0, 0, 8)
	activeCountLabel.BackgroundTransparency = 1
	activeCountLabel.TextColor3 = COLORS.teamRed
	activeCountLabel.Text = "0"
	activeCountLabel.TextSize = 28
	activeCountLabel.Font = Enum.Font.GothamBlack
	activeCountLabel.Parent = activeCountFrame
	guiElements.activeCountLabel = activeCountLabel

	local activeCountText = Instance.new("TextLabel")
	activeCountText.Size = UDim2.new(1, 0, 0, 20)
	activeCountText.Position = UDim2.new(0, 0, 0, 42)
	activeCountText.BackgroundTransparency = 1
	activeCountText.TextColor3 = COLORS.parchment
	activeCountText.Text = "ê²Œì„ ì¤‘"
	activeCountText.TextSize = 12
	activeCountText.Font = Enum.Font.GothamBold
	activeCountText.Parent = activeCountFrame

	-- ì»¨í…ì¸  ì˜ì—­
	local contentFrame = Instance.new("Frame")
	contentFrame.Name = "ContentFrame"
	contentFrame.Size = UDim2.new(1, -40, 1, -230)
	contentFrame.Position = UDim2.new(0, 20, 0, 150)
	contentFrame.BackgroundColor3 = COLORS.parchment
	contentFrame.BackgroundTransparency = 0.3
	contentFrame.BorderSizePixel = 0
	contentFrame.Parent = mainFrame

	local contentCorner = Instance.new("UICorner")
	contentCorner.CornerRadius = UDim.new(0, 12)
	contentCorner.Parent = contentFrame

	-- ë°© ëª©ë¡ ìŠ¤í¬ë¡¤ í”„ë ˆì„
	local roomListScroll = Instance.new("ScrollingFrame")
	roomListScroll.Name = "RoomListScroll"
	roomListScroll.Size = UDim2.new(1, -16, 1, -16)
	roomListScroll.Position = UDim2.new(0, 8, 0, 8)
	roomListScroll.BackgroundTransparency = 1
	roomListScroll.BorderSizePixel = 0
	roomListScroll.ScrollBarThickness = 6
	roomListScroll.ScrollBarImageColor3 = COLORS.gold
	roomListScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
	roomListScroll.Parent = contentFrame

	local roomListLayout = Instance.new("UIGridLayout")
	roomListLayout.SortOrder = Enum.SortOrder.LayoutOrder
	roomListLayout.CellSize = UDim2.new(0, 280, 0, 380) -- ì¹´ë“œ í¬ê¸° ëŒ€í­ í™•ëŒ€
	roomListLayout.CellPadding = UDim2.new(0, 20, 0, 20)
	roomListLayout.FillDirection = Enum.FillDirection.Horizontal
	roomListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
	roomListLayout.Parent = roomListScroll

	-- í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­
	local bottomBar = Instance.new("Frame")
	bottomBar.Name = "BottomBar"
	bottomBar.Size = UDim2.new(1, -40, 0, 60)
	bottomBar.Position = UDim2.new(0, 20, 1, -70)
	bottomBar.BackgroundTransparency = 1
	bottomBar.Parent = mainFrame

	-- ë¹ ë¥¸ ì°¸ê°€ ë²„íŠ¼ (í¬ê²Œ)
	local quickJoinButton = Instance.new("TextButton")
	quickJoinButton.Name = "QuickJoinButton"
	quickJoinButton.Size = UDim2.new(0.65, -5, 1, 0)
	quickJoinButton.Position = UDim2.new(0, 0, 0, 0)
	quickJoinButton.BackgroundColor3 = COLORS.gold
	quickJoinButton.TextColor3 = COLORS.black
	quickJoinButton.Text = "ë¹ ë¥¸ ì°¸ê°€"
	quickJoinButton.TextSize = 22
	quickJoinButton.Font = Enum.Font.GothamBlack
	quickJoinButton.Parent = bottomBar

	local quickCorner = Instance.new("UICorner")
	quickCorner.CornerRadius = UDim.new(0, 12)
	quickCorner.Parent = quickJoinButton

	local quickStroke = Instance.new("UIStroke")
	quickStroke.Color = COLORS.goldDark
	quickStroke.Thickness = 3
	quickStroke.Parent = quickJoinButton

	-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
	local refreshButton = Instance.new("TextButton")
	refreshButton.Name = "RefreshButton"
	refreshButton.Size = UDim2.new(0.35, -5, 1, 0)
	refreshButton.Position = UDim2.new(0.65, 5, 0, 0)
	refreshButton.BackgroundColor3 = COLORS.woodLight
	refreshButton.TextColor3 = COLORS.gold
	refreshButton.Text = "ìƒˆë¡œê³ ì¹¨"
	refreshButton.TextSize = 18
	refreshButton.Font = Enum.Font.GothamBold
	refreshButton.Parent = bottomBar

	local refreshCorner = Instance.new("UICorner")
	refreshCorner.CornerRadius = UDim.new(0, 12)
	refreshCorner.Parent = refreshButton

	local refreshStroke = Instance.new("UIStroke")
	refreshStroke.Color = COLORS.goldDark
	refreshStroke.Thickness = 2
	refreshStroke.Parent = refreshButton

	return closeButton, quickJoinButton, refreshButton, roomListScroll
end

-- GUI ìš”ì†Œ ìƒì„±
local closeButton, quickJoinButton, refreshButton, roomListScroll = createGuiElements()

-- ì…ì¥ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ ìƒíƒœ
local selectedRoomId = nil
local confirmDialog = nil

-- ì…ì¥ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ ìƒì„±
local function createConfirmDialog()
	local dialog = Instance.new("Frame")
	dialog.Name = "ConfirmDialog"
	dialog.Size = UDim2.new(1, 0, 1, 0)
	dialog.Position = UDim2.new(0, 0, 0, 0)
	dialog.BackgroundColor3 = COLORS.black
	dialog.BackgroundTransparency = 0.5
	dialog.Visible = false
	dialog.ZIndex = 10
	dialog.Parent = mainFrame

	local dialogBox = Instance.new("Frame")
	dialogBox.Size = UDim2.new(0, 300, 0, 180)
	dialogBox.Position = UDim2.new(0.5, -150, 0.5, -90)
	dialogBox.BackgroundColor3 = COLORS.woodDark
	dialogBox.ZIndex = 11
	dialogBox.Parent = dialog

	local boxCorner = Instance.new("UICorner")
	boxCorner.CornerRadius = UDim.new(0, 16)
	boxCorner.Parent = dialogBox

	local boxStroke = Instance.new("UIStroke")
	boxStroke.Color = COLORS.goldDark
	boxStroke.Thickness = 3
	boxStroke.Parent = dialogBox

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Name = "Title"
	titleLabel.Size = UDim2.new(1, 0, 0, 40)
	titleLabel.Position = UDim2.new(0, 0, 0, 15)
	titleLabel.BackgroundTransparency = 1
	titleLabel.TextColor3 = COLORS.gold
	titleLabel.Text = "ê²Œì„ì— ì°¸ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
	titleLabel.TextSize = 18
	titleLabel.Font = Enum.Font.GothamBlack
	titleLabel.ZIndex = 12
	titleLabel.Parent = dialogBox

	local infoLabel = Instance.new("TextLabel")
	infoLabel.Name = "Info"
	infoLabel.Size = UDim2.new(1, -20, 0, 50)
	infoLabel.Position = UDim2.new(0, 10, 0, 55)
	infoLabel.BackgroundTransparency = 1
	infoLabel.TextColor3 = COLORS.parchment
	infoLabel.Text = ""
	infoLabel.TextSize = 14
	infoLabel.Font = Enum.Font.GothamBold
	infoLabel.TextWrapped = true
	infoLabel.ZIndex = 12
	infoLabel.Parent = dialogBox

	local confirmBtn = Instance.new("TextButton")
	confirmBtn.Name = "ConfirmBtn"
	confirmBtn.Size = UDim2.new(0, 120, 0, 40)
	confirmBtn.Position = UDim2.new(0, 25, 1, -55)
	confirmBtn.BackgroundColor3 = COLORS.green
	confirmBtn.TextColor3 = COLORS.white
	confirmBtn.Text = "í™•ì¸"
	confirmBtn.TextSize = 16
	confirmBtn.Font = Enum.Font.GothamBlack
	confirmBtn.ZIndex = 12
	confirmBtn.Parent = dialogBox

	local confirmCorner = Instance.new("UICorner")
	confirmCorner.CornerRadius = UDim.new(0, 10)
	confirmCorner.Parent = confirmBtn

	local cancelBtn = Instance.new("TextButton")
	cancelBtn.Name = "CancelBtn"
	cancelBtn.Size = UDim2.new(0, 120, 0, 40)
	cancelBtn.Position = UDim2.new(1, -145, 1, -55)
	cancelBtn.BackgroundColor3 = COLORS.red
	cancelBtn.TextColor3 = COLORS.white
	cancelBtn.Text = "ì·¨ì†Œ"
	cancelBtn.TextSize = 16
	cancelBtn.Font = Enum.Font.GothamBlack
	cancelBtn.ZIndex = 12
	cancelBtn.Parent = dialogBox

	local cancelCorner = Instance.new("UICorner")
	cancelCorner.CornerRadius = UDim.new(0, 10)
	cancelCorner.Parent = cancelBtn

	-- ë²„íŠ¼ ì´ë²¤íŠ¸
	confirmBtn.MouseButton1Click:Connect(function()
		if selectedRoomId then
			dialog.Visible = false
			replicatedStorage:WaitForChild("JoinGameRoom"):FireServer(selectedRoomId)
		end
	end)

	cancelBtn.MouseButton1Click:Connect(function()
		dialog.Visible = false
		selectedRoomId = nil
	end)

	return dialog
end

-- ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
local function showConfirmDialog(roomId, roomData, liveData)
	if not confirmDialog then
		confirmDialog = createConfirmDialog()
	end

	selectedRoomId = roomId
	local gameMode = liveData and liveData.gameMode or "deathmatch"
	local gameState = liveData and liveData.gameState or "waiting"
	local playerCount = liveData and liveData.playerCount or #roomData.players
	local maxPlayers = roomData.maxPlayersCount or 16

	local stateText = gameState == "playing" and "ê²Œì„ ì¤‘" or gameState == "starting" and "ì‹œì‘ ëŒ€ê¸° ì¤‘" or "ëŒ€ê¸° ì¤‘"
	local infoText = string.format("ëª¨ë“œ: íŒ€ ë°ìŠ¤ë§¤ì¹˜\nìƒíƒœ: %s\nì¸ì›: %d / %d", stateText, playerCount, maxPlayers)

	confirmDialog:FindFirstChild("ConfirmDialog") -- unused
	local dialogBox = confirmDialog:FindFirstChildOfClass("Frame")
	if dialogBox then
		local infoLabel = dialogBox:FindFirstChild("Info")
		if infoLabel then
			infoLabel.Text = infoText
		end
	end

	confirmDialog.Visible = true
end

-- ë°© ì¹´ë“œ ìƒì„± í•¨ìˆ˜ (ìƒˆ ë””ìì¸ - ì¹´ë“œ í˜•íƒœ)
local function createRoomCard(roomId, roomData, liveData, index)
	local playerCount = liveData and liveData.playerCount or #roomData.players
	local maxPlayers = roomData.maxPlayersCount or 16
	local isFull = playerCount >= maxPlayers
	local gameState = liveData and liveData.gameState or "waiting"
	local gameMode = liveData and liveData.gameMode or "deathmatch"

	-- ì¹´ë“œ ì „ì²´ë¥¼ ë²„íŠ¼ìœ¼ë¡œ ìƒì„± (UIGridLayoutì´ í¬ê¸° ì œì–´)
	local card = Instance.new("TextButton")
	card.Name = "Room_" .. roomId
	card.BackgroundColor3 = COLORS.woodDark
	card.BorderSizePixel = 0
	card.LayoutOrder = index
	card.Text = ""
	card.AutoButtonColor = false

	local cardCorner = Instance.new("UICorner")
	cardCorner.CornerRadius = UDim.new(0, 12)
	cardCorner.Parent = card

	local cardStroke = Instance.new("UIStroke")
	cardStroke.Color = COLORS.goldDark
	cardStroke.Thickness = 2
	cardStroke.Parent = card

	-- ìƒë‹¨: ê²Œì„ ìƒíƒœ ë°°ì§€
	local statusBadge = Instance.new("Frame")
	statusBadge.Size = UDim2.new(1, -24, 0, 36)
	statusBadge.Position = UDim2.new(0, 12, 0, 12)
	statusBadge.BackgroundColor3 = gameState == "playing" and COLORS.green or gameState == "starting" and COLORS.gold or gameState == "ended" and COLORS.red or COLORS.blue
	statusBadge.Parent = card

	local badgeCorner = Instance.new("UICorner")
	badgeCorner.CornerRadius = UDim.new(0, 10)
	badgeCorner.Parent = statusBadge

	local statusLabel = Instance.new("TextLabel")
	statusLabel.Size = UDim2.new(1, 0, 1, 0)
	statusLabel.BackgroundTransparency = 1
	statusLabel.TextColor3 = COLORS.white
	statusLabel.Font = Enum.Font.GothamBold
	statusLabel.TextSize = 18
	statusLabel.Parent = statusBadge

	-- ìƒíƒœë³„ í…ìŠ¤íŠ¸
	if gameState == "playing" then
		local remaining = liveData and liveData.matchTimeRemaining or 0
		statusLabel.Text = "ê²Œì„ ì¤‘ " .. formatTime(remaining)
	elseif gameState == "starting" then
		local countdown = liveData and liveData.countdownTime or 0
		statusLabel.Text = countdown .. "ì´ˆ í›„ ì‹œì‘"
	elseif gameState == "ended" then
		local endCountdown = liveData and liveData.endCountdown or 0
		statusLabel.Text = endCountdown .. "ì´ˆ í›„ ì¬ì‹œì‘"
	else
		-- ëŒ€ê¸° ì¤‘
		if liveData and liveData.canStart then
			statusLabel.Text = "ê³§ ì‹œì‘!"
			statusBadge.BackgroundColor3 = COLORS.green
		else
			statusLabel.Text = "ëŒ€ê¸° ì¤‘"
		end
	end

	-- ì¤‘ì•™: í° ê²Œì„ ëª¨ë“œ ì•„ì´ì½˜ (ëŒ€í­ í™•ëŒ€)
	local iconSize = 180
	local modeIcon = Instance.new("ImageLabel")
	modeIcon.Size = UDim2.new(0, iconSize, 0, iconSize)
	modeIcon.Position = UDim2.new(0.5, -iconSize/2, 0, 60)
	modeIcon.BackgroundTransparency = 1
	modeIcon.Image = GAME_MODE_ICONS[gameMode] or GAME_MODE_ICONS.deathmatch
	modeIcon.Parent = card

	-- ì•„ì´ì½˜ ì•„ë˜: ê²Œì„ ëª¨ë“œ ì´ë¦„
	local modeLabel = Instance.new("TextLabel")
	modeLabel.Size = UDim2.new(1, 0, 0, 30)
	modeLabel.Position = UDim2.new(0, 0, 0, 250)
	modeLabel.BackgroundTransparency = 1
	modeLabel.TextColor3 = COLORS.gold
	modeLabel.Text = "íŒ€ ë°ìŠ¤ë§¤ì¹˜"
	modeLabel.TextSize = 20
	modeLabel.Font = Enum.Font.GothamBlack
	modeLabel.Parent = card

	-- í•˜ë‹¨: ì •ë³´ ì˜ì—­
	local infoFrame = Instance.new("Frame")
	infoFrame.Size = UDim2.new(1, -24, 0, 80)
	infoFrame.Position = UDim2.new(0, 12, 1, -92)
	infoFrame.BackgroundColor3 = COLORS.black
	infoFrame.BackgroundTransparency = 0.5
	infoFrame.Parent = card

	local infoCorner = Instance.new("UICorner")
	infoCorner.CornerRadius = UDim.new(0, 12)
	infoCorner.Parent = infoFrame

	-- ì¸ì› ìˆ˜
	local playerLabel = Instance.new("TextLabel")
	playerLabel.Size = UDim2.new(1, 0, 0, 36)
	playerLabel.Position = UDim2.new(0, 0, 0, 8)
	playerLabel.BackgroundTransparency = 1
	playerLabel.TextColor3 = isFull and COLORS.red or COLORS.gold
	playerLabel.Text = string.format("ğŸ‘¤ %d / %d", playerCount, maxPlayers)
	playerLabel.TextSize = 22
	playerLabel.Font = Enum.Font.GothamBlack
	playerLabel.Parent = infoFrame

	-- ì¶”ê°€ ì •ë³´ (íŒ€ ì¸ì›, ìŠ¤ì½”ì–´ ë“±)
	local detailLabel = Instance.new("TextLabel")
	detailLabel.Size = UDim2.new(1, 0, 0, 28)
	detailLabel.Position = UDim2.new(0, 0, 0, 44)
	detailLabel.BackgroundTransparency = 1
	detailLabel.TextColor3 = COLORS.parchment
	detailLabel.TextSize = 16
	detailLabel.Font = Enum.Font.GothamBold
	detailLabel.Parent = infoFrame

	if gameState == "playing" and liveData then
		local teamAScore = liveData.teamScores and liveData.teamScores.TeamA or 0
		local teamBScore = liveData.teamScores and liveData.teamScores.TeamB or 0
		detailLabel.Text = string.format("ğŸ”´ %d vs %d ğŸ”µ", teamAScore, teamBScore)
	elseif liveData then
		local teamCounts = liveData.teamCounts or {}
		local teamA = teamCounts.TeamA or 0
		local teamB = teamCounts.TeamB or 0
		detailLabel.Text = string.format("ğŸ”´ %dëª…  ğŸ”µ %dëª…", teamA, teamB)
	else
		detailLabel.Text = isFull and "ë°©ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤" or "í´ë¦­í•˜ì—¬ ì°¸ê°€"
	end

	-- ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ (ì…ì¥ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ)
	if not isFull then
		card.MouseButton1Click:Connect(function()
			showConfirmDialog(roomId, roomData, liveData)
		end)

		card.MouseEnter:Connect(function()
			card.BackgroundColor3 = COLORS.woodLight
			cardStroke.Color = COLORS.gold
			cardStroke.Thickness = 3
		end)
		card.MouseLeave:Connect(function()
			card.BackgroundColor3 = COLORS.woodDark
			cardStroke.Color = COLORS.goldDark
			cardStroke.Thickness = 2
		end)
	else
		-- ë§Œì„ì¸ ê²½ìš° ì–´ë‘¡ê²Œ í‘œì‹œ
		card.BackgroundColor3 = COLORS.rope
		modeIcon.ImageTransparency = 0.5
	end

	return card
end

-- ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
local function updateSummary(rooms)
	local roomCount = 0
	local totalPlayers = 0
	local activeGames = 0

	for _, roomData in pairs(rooms) do
		roomCount = roomCount + 1
		local liveStatus = roomData.liveStatus
		local playerCount = liveStatus and liveStatus.playerCount or #roomData.players
		local gameState = liveStatus and liveStatus.gameState or "waiting"

		totalPlayers = totalPlayers + playerCount
		if gameState == "playing" then
			activeGames = activeGames + 1
		end
	end

	guiElements.roomCountLabel.Text = tostring(roomCount)
	guiElements.playerCountLabel.Text = tostring(totalPlayers)
	guiElements.activeCountLabel.Text = tostring(activeGames)
end

-- ë°© ëª©ë¡ ì—…ë°ì´íŠ¸
local function updateRoomList(rooms)
	-- ë°© ë°ì´í„° ìºì‹œ ì—…ë°ì´íŠ¸
	roomDataCache = rooms

	-- ê¸°ì¡´ ë°© ì¹´ë“œ ì œê±°
	for _, child in ipairs(roomListScroll:GetChildren()) do
		if child:IsA("TextButton") or child:IsA("TextLabel") then
			child:Destroy()
		end
	end

	-- ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
	updateSummary(rooms)

	local index = 1
	local hasRooms = false

	for roomId, roomData in pairs(rooms) do
		hasRooms = true
		-- roomData.liveStatusë¥¼ ì§ì ‘ ì‚¬ìš© (ì„œë²„ì—ì„œ í•©ì³ì„œ ì „ì†¡)
		local liveData = roomData.liveStatus
		local card = createRoomCard(roomId, roomData, liveData, index)
		card.Parent = roomListScroll
		index = index + 1
	end

	-- ë°©ì´ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
	if not hasRooms then
		local noRoomFrame = Instance.new("Frame")
		noRoomFrame.Size = UDim2.new(1, 0, 0, 100)
		noRoomFrame.BackgroundTransparency = 1
		noRoomFrame.Parent = roomListScroll

		local noRoomIcon = Instance.new("TextLabel")
		noRoomIcon.Size = UDim2.new(1, 0, 0, 40)
		noRoomIcon.Position = UDim2.new(0, 0, 0, 10)
		noRoomIcon.BackgroundTransparency = 1
		noRoomIcon.TextColor3 = COLORS.woodDark
		noRoomIcon.Text = "ğŸš«"
		noRoomIcon.TextSize = 32
		noRoomIcon.Parent = noRoomFrame

		local noRoomLabel = Instance.new("TextLabel")
		noRoomLabel.Size = UDim2.new(1, 0, 0, 40)
		noRoomLabel.Position = UDim2.new(0, 0, 0, 50)
		noRoomLabel.BackgroundTransparency = 1
		noRoomLabel.TextColor3 = COLORS.woodDark
		noRoomLabel.Text = "í˜„ì¬ ì—´ë¦° ë°©ì´ ì—†ìŠµë‹ˆë‹¤.\në¹ ë¥¸ ì°¸ê°€ë¥¼ ëˆŒëŸ¬ ìƒˆ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”!"
		noRoomLabel.TextSize = 14
		noRoomLabel.Font = Enum.Font.GothamBold
		noRoomLabel.TextWrapped = true
		noRoomLabel.Parent = noRoomFrame
	end

	-- ìŠ¤í¬ë¡¤ ìº”ë²„ìŠ¤ í¬ê¸° ì—…ë°ì´íŠ¸ (ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ)
	-- ì¹´ë“œ í¬ê¸°: 280x380, íŒ¨ë”©: 20
	-- ìŠ¤í¬ë¡¤ ì˜ì—­ ë„ˆë¹„ì— ë”°ë¼ í•œ í–‰ì— ë“¤ì–´ê°€ëŠ” ì¹´ë“œ ìˆ˜ ê³„ì‚°
	local scrollWidth = roomListScroll.AbsoluteSize.X
	local cardWidth = 280 + 20 -- ì¹´ë“œ ë„ˆë¹„ + íŒ¨ë”©
	local cardsPerRow = math.max(1, math.floor(scrollWidth / cardWidth))
	local rowCount = math.ceil((index - 1) / cardsPerRow)
	local cardHeight = 380 + 20 -- ì¹´ë“œ ë†’ì´ + íŒ¨ë”©
	roomListScroll.CanvasSize = UDim2.new(0, 0, 0, rowCount * cardHeight)
end

-- ì„œë²„ì—ì„œ ë°© ëª©ë¡ ìš”ì²­
local function requestRoomList()
	replicatedStorage:WaitForChild("RequestGameList"):FireServer()
end

-- ë¹ ë¥¸ ì°¸ê°€
local isJoining = false
quickJoinButton.MouseButton1Click:Connect(function()
	if isJoining then return end
	isJoining = true
	quickJoinButton.Text = "ë§¤ì¹­ ì¤‘..."
	quickJoinButton.BackgroundColor3 = COLORS.rope

	-- í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜
	local tween = TweenService:Create(quickJoinButton, TweenInfo.new(0.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
		BackgroundTransparency = 0.3
	})
	tween:Play()
	quickJoinButton:SetAttribute("PulseTween", true)

	local quickJoinEvent = replicatedStorage:FindFirstChild("QuickJoin")
	if quickJoinEvent then
		quickJoinEvent:FireServer()
	end
end)

quickJoinButton.MouseEnter:Connect(function()
	if not isJoining then
		quickJoinButton.BackgroundColor3 = COLORS.goldDark
	end
end)
quickJoinButton.MouseLeave:Connect(function()
	if not isJoining then
		quickJoinButton.BackgroundColor3 = COLORS.gold
	end
end)

-- ìƒˆë¡œê³ ì¹¨
refreshButton.MouseButton1Click:Connect(function()
	refreshButton.Text = "ë¡œë”©..."
	refreshButton.BackgroundColor3 = COLORS.rope
	requestRoomList()
	task.delay(1, function()
		refreshButton.Text = "ìƒˆë¡œê³ ì¹¨"
		refreshButton.BackgroundColor3 = COLORS.woodLight
	end)
end)

refreshButton.MouseEnter:Connect(function()
	refreshButton.BackgroundColor3 = COLORS.goldDark
end)
refreshButton.MouseLeave:Connect(function()
	refreshButton.BackgroundColor3 = COLORS.woodLight
end)

-- ë‹«ê¸°
closeButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = false
	isJoining = false
	quickJoinButton.Text = "ë¹ ë¥¸ ì°¸ê°€"
	quickJoinButton.BackgroundColor3 = COLORS.gold
	quickJoinButton.BackgroundTransparency = 0
end)

closeButton.MouseEnter:Connect(function()
	closeButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
end)
closeButton.MouseLeave:Connect(function()
	closeButton.BackgroundColor3 = COLORS.red
end)

-- ì„œë²„ë¡œë¶€í„° ë°© ëª©ë¡ ìˆ˜ì‹ 
replicatedStorage:WaitForChild("UpdateGameList").OnClientEvent:Connect(function(rooms)
	updateRoomList(rooms)
end)

-- ì„œë²„ë¡œë¶€í„° ë§¤ì¹­ ìƒíƒœ ìˆ˜ì‹ 
local matchStatusEvent = replicatedStorage:WaitForChild("MatchStatus", 5)
if matchStatusEvent then
	matchStatusEvent.OnClientEvent:Connect(function(data)
		if data.status == "matched" then
			quickJoinButton.Text = "ì…ì¥!"
			quickJoinButton.BackgroundColor3 = COLORS.green
			quickJoinButton.BackgroundTransparency = 0
		elseif data.status == "matching" then
			quickJoinButton.Text = string.format("ë§¤ì¹­ ì¤‘... (%d/%d)", data.playerCount or 0, data.maxPlayers or 16)
		elseif data.status == "error" then
			isJoining = false
			quickJoinButton.Text = "ë¹ ë¥¸ ì°¸ê°€"
			quickJoinButton.BackgroundColor3 = COLORS.gold
			quickJoinButton.BackgroundTransparency = 0
		end
	end)
end

-- ì‹¤ì‹œê°„ ê²Œì„ ìƒíƒœ ìˆ˜ì‹  (Pirateì—ì„œ MessagingServiceë¡œ ì „ì†¡)
local liveMatchEvent = replicatedStorage:WaitForChild("LiveMatchUpdate", 5)
if liveMatchEvent then
	liveMatchEvent.OnClientEvent:Connect(function(data)
		if data and data.roomId then
			-- ìºì‹œëœ ë°© ë°ì´í„°ì— ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸
			if roomDataCache[data.roomId] then
				roomDataCache[data.roomId].liveStatus = data
				-- ìºì‹œëœ ë°ì´í„°ë¡œ UI ì—…ë°ì´íŠ¸ (ì„œë²„ ìš”ì²­ ì—†ì´)
				updateRoomList(roomDataCache)
			else
				-- ìºì‹œì— ì—†ìœ¼ë©´ ì„œë²„ì—ì„œ ì „ì²´ ëª©ë¡ ë‹¤ì‹œ ìš”ì²­
				requestRoomList()
			end
		end
	end)
end

-- GUI í‘œì‹œë  ë•Œ ë°© ëª©ë¡ ìš”ì²­
replicatedStorage:WaitForChild("ShowGameRoomGui").OnClientEvent:Connect(function()
	mainFrame.Visible = true
	isJoining = false
	quickJoinButton.Text = "ë¹ ë¥¸ ì°¸ê°€"
	quickJoinButton.BackgroundColor3 = COLORS.gold
	quickJoinButton.BackgroundTransparency = 0
	requestRoomList()
end)

-- ì´ˆê¸° ë°© ëª©ë¡ ìš”ì²­
if mainFrame.Visible then
	requestRoomList()
end

print("[GameRoomGui] ì´ˆê¸°í™” ì™„ë£Œ")
